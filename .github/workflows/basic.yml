on:
  #push:
  #pull_request:
  workflow_dispatch:

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
        with:
          repository: HotCakeX/Harden-Windows-Security
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 10.0.x
      - run: |
          version=$(dotnet --version)
          echo "::notice::Using .NET SDK version: $version"
          dotnet --list-sdks
      - run: |
          # Find all project files
          project_files=$(find . -type f \( -name "*.csproj" -o -name "*.sln" -o -name "*.vbproj" -o -name "*.vcxproj" -o -name "*.fsproj" \) | grep -v '/obj/' | grep -v '/bin/' | head -20)
          
          if [ -z "$project_files" ]; then
            echo "valid-project=false" >> "$GITHUB_OUTPUT"
            echo "### :warning: No .NET project files found" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**This repository does not appear to contain any .NET project files.**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Searched for: *.csproj, *.sln, packages.config, *.vbproj, *.vcxproj, *.fsproj" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "If this is a .NET project, ensure your project files are committed to the repository." >> $GITHUB_STEP_SUMMARY
            echo "::error::No .NET project files found in repository"
            exit 1
          fi
          
          echo "Found project files:"
          echo "$project_files"
          
          # Restore all projects
          while IFS= read -r project; do
            echo "Restoring project: $project"
            if ! dotnet restore "$project"; then
              echo "::error::Failed to restore project: $project"
              echo "valid-project=false" >> "$GITHUB_OUTPUT"
              exit 1
            fi
          done <<< "$project_files"
          
          echo "::debug::All projects restored successfully"
          echo "valid-project=true" >> "$GITHUB_OUTPUT"
